<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
      <title>Istekohtade valimine</title>
    <link rel="stylesheet" type="text/css" href="/styleIstekohad.css">
    <link rel="stylesheet" type="text/css" href="/styleNavBar.css">
  </head>

  <body>
    <header>
      <div class="container">
        <nav>
          <ul class="nav_links">
            <li><a th:href="@{'/'}">Home</a></li>
            <li><a th:href="@{'/broneeri'}">Broneeri lend</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <h1>Vali istekoht</h1>
    <div class="container">
      <div class="plane" id="plane"></div>
      <div>
        <h2>Istekoha info:</h2>
        <p id="seat-info">Vali iste</p>
        <button id="book-button">Broneeri iste</button>
      </div>
    </div>

    <script>
      const rows = 6;
      const seats = ['A', 'B', '', 'C', 'D']; // "" esindab vahek√§iku
      const totalSeats = rows * 4; // Kokku 4 istekohta rea kohta
      const takenCount = Math.floor(Math.random() * (totalSeats / 2)) + 1; // Juhuslik arv kinni olevaid kohti
      const takenSeats = new Set();
      const bookedSeats = new Set(); // Salvestab kasutaja broneeritud istekohad
      let selectedSeat = null; // Praegu valitud istekoht

      while (takenSeats.size < takenCount) {
        let randomRow = Math.floor(Math.random() * rows) + 1;
        let randomSeat = seats.filter(s => s !== "")[Math.floor(Math.random() * 4)];
        takenSeats.add(`${randomRow}${randomSeat}`);
      }

      const planeDiv = document.getElementById("plane");
      const seatInfo = document.getElementById("seat-info");
      const bookButton = document.getElementById("book-button");

      for (let row = 1; row <= rows; row++) {
        seats.forEach(seat => {
          if (seat === "") {
            const emptyDiv = document.createElement("div");
            emptyDiv.style.width = "50px";
            planeDiv.appendChild(emptyDiv);
          } else {
            const seatId = `${row}${seat}`;
            const btn = document.createElement("button");
            btn.innerText = seatId;
            btn.classList.add("seat");

            if (takenSeats.has(seatId)) {
              btn.classList.add("taken");
              btn.disabled = true;
            }

            btn.addEventListener("click", () => {
              if (bookedSeats.has(seatId)) return; // Ei luba broneeritud istekohta valida

              document.querySelectorAll(".seat.selected").forEach(s => s.classList.remove("selected"));
              btn.classList.add("selected");
              selectedSeat = seatId;

              const isAknaga = seat === "A" || seat === "D" ? " (Aknaga iste)" : "";
              seatInfo.innerText = `Valitud iste: ${seatId}${isAknaga}`;
              bookButton.style.display = "block";
            });

            planeDiv.appendChild(btn);
          }
        });
      }

      bookButton.addEventListener("click", () => {
        if (selectedSeat) {
          alert("Iste broneeritud!");

          bookedSeats.add(selectedSeat); // Salvestame broneeritud istekohad
          const selectedButton = document.querySelector(".seat.selected");
          selectedButton.classList.remove("selected");
          selectedButton.classList.add("booked");
          selectedButton.disabled = true;

          seatInfo.innerText = `Broneeritud iste: ${selectedSeat}`;
          bookButton.style.display = "none";
          selectedSeat = null;
        }
      });
    </script>
  </body>
</html>